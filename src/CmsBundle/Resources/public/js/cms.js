var Latinise={};Latinise.latin_map={"Á":"A",
    "Ă":"A",
    "Ắ":"A",
    "Ặ":"A",
    "Ằ":"A",
    "Ẳ":"A",
    "Ẵ":"A",
    "Ǎ":"A",
    "Â":"A",
    "Ấ":"A",
    "Ậ":"A",
    "Ầ":"A",
    "Ẩ":"A",
    "Ẫ":"A",
    "Ä":"A",
    "Ǟ":"A",
    "Ȧ":"A",
    "Ǡ":"A",
    "Ạ":"A",
    "Ȁ":"A",
    "À":"A",
    "Ả":"A",
    "Ȃ":"A",
    "Ā":"A",
    "Ą":"A",
    "Å":"A",
    "Ǻ":"A",
    "Ḁ":"A",
    "Ⱥ":"A",
    "Ã":"A",
    "Ꜳ":"AA",
    "Æ":"AE",
    "Ǽ":"AE",
    "Ǣ":"AE",
    "Ꜵ":"AO",
    "Ꜷ":"AU",
    "Ꜹ":"AV",
    "Ꜻ":"AV",
    "Ꜽ":"AY",
    "Ḃ":"B",
    "Ḅ":"B",
    "Ɓ":"B",
    "Ḇ":"B",
    "Ƀ":"B",
    "Ƃ":"B",
    "Ć":"C",
    "Č":"C",
    "Ç":"C",
    "Ḉ":"C",
    "Ĉ":"C",
    "Ċ":"C",
    "Ƈ":"C",
    "Ȼ":"C",
    "Ď":"D",
    "Ḑ":"D",
    "Ḓ":"D",
    "Ḋ":"D",
    "Ḍ":"D",
    "Ɗ":"D",
    "Ḏ":"D",
    "ǲ":"D",
    "ǅ":"D",
    "Đ":"D",
    "Ƌ":"D",
    "Ǳ":"DZ",
    "Ǆ":"DZ",
    "É":"E",
    "Ĕ":"E",
    "Ě":"E",
    "Ȩ":"E",
    "Ḝ":"E",
    "Ê":"E",
    "Ế":"E",
    "Ệ":"E",
    "Ề":"E",
    "Ể":"E",
    "Ễ":"E",
    "Ḙ":"E",
    "Ë":"E",
    "Ė":"E",
    "Ẹ":"E",
    "Ȅ":"E",
    "È":"E",
    "Ẻ":"E",
    "Ȇ":"E",
    "Ē":"E",
    "Ḗ":"E",
    "Ḕ":"E",
    "Ę":"E",
    "Ɇ":"E",
    "Ẽ":"E",
    "Ḛ":"E",
    "Ꝫ":"ET",
    "Ḟ":"F",
    "Ƒ":"F",
    "Ǵ":"G",
    "Ğ":"G",
    "Ǧ":"G",
    "Ģ":"G",
    "Ĝ":"G",
    "Ġ":"G",
    "Ɠ":"G",
    "Ḡ":"G",
    "Ǥ":"G",
    "Ḫ":"H",
    "Ȟ":"H",
    "Ḩ":"H",
    "Ĥ":"H",
    "Ⱨ":"H",
    "Ḧ":"H",
    "Ḣ":"H",
    "Ḥ":"H",
    "Ħ":"H",
    "Í":"I",
    "Ĭ":"I",
    "Ǐ":"I",
    "Î":"I",
    "Ï":"I",
    "Ḯ":"I",
    "İ":"I",
    "Ị":"I",
    "Ȉ":"I",
    "Ì":"I",
    "Ỉ":"I",
    "Ȋ":"I",
    "Ī":"I",
    "Į":"I",
    "Ɨ":"I",
    "Ĩ":"I",
    "Ḭ":"I",
    "Ꝺ":"D",
    "Ꝼ":"F",
    "Ᵹ":"G",
    "Ꞃ":"R",
    "Ꞅ":"S",
    "Ꞇ":"T",
    "Ꝭ":"IS",
    "Ĵ":"J",
    "Ɉ":"J",
    "Ḱ":"K",
    "Ǩ":"K",
    "Ķ":"K",
    "Ⱪ":"K",
    "Ꝃ":"K",
    "Ḳ":"K",
    "Ƙ":"K",
    "Ḵ":"K",
    "Ꝁ":"K",
    "Ꝅ":"K",
    "Ĺ":"L",
    "Ƚ":"L",
    "Ľ":"L",
    "Ļ":"L",
    "Ḽ":"L",
    "Ḷ":"L",
    "Ḹ":"L",
    "Ⱡ":"L",
    "Ꝉ":"L",
    "Ḻ":"L",
    "Ŀ":"L",
    "Ɫ":"L",
    "ǈ":"L",
    "Ł":"L",
    "Ǉ":"LJ",
    "Ḿ":"M",
    "Ṁ":"M",
    "Ṃ":"M",
    "Ɱ":"M",
    "Ń":"N",
    "Ň":"N",
    "Ņ":"N",
    "Ṋ":"N",
    "Ṅ":"N",
    "Ṇ":"N",
    "Ǹ":"N",
    "Ɲ":"N",
    "Ṉ":"N",
    "Ƞ":"N",
    "ǋ":"N",
    "Ñ":"N",
    "Ǌ":"NJ",
    "Ó":"O",
    "Ŏ":"O",
    "Ǒ":"O",
    "Ô":"O",
    "Ố":"O",
    "Ộ":"O",
    "Ồ":"O",
    "Ổ":"O",
    "Ỗ":"O",
    "Ö":"O",
    "Ȫ":"O",
    "Ȯ":"O",
    "Ȱ":"O",
    "Ọ":"O",
    "Ő":"O",
    "Ȍ":"O",
    "Ò":"O",
    "Ỏ":"O",
    "Ơ":"O",
    "Ớ":"O",
    "Ợ":"O",
    "Ờ":"O",
    "Ở":"O",
    "Ỡ":"O",
    "Ȏ":"O",
    "Ꝋ":"O",
    "Ꝍ":"O",
    "Ō":"O",
    "Ṓ":"O",
    "Ṑ":"O",
    "Ɵ":"O",
    "Ǫ":"O",
    "Ǭ":"O",
    "Ø":"O",
    "Ǿ":"O",
    "Õ":"O",
    "Ṍ":"O",
    "Ṏ":"O",
    "Ȭ":"O",
    "Ƣ":"OI",
    "Ꝏ":"OO",
    "Ɛ":"E",
    "Ɔ":"O",
    "Ȣ":"OU",
    "Ṕ":"P",
    "Ṗ":"P",
    "Ꝓ":"P",
    "Ƥ":"P",
    "Ꝕ":"P",
    "Ᵽ":"P",
    "Ꝑ":"P",
    "Ꝙ":"Q",
    "Ꝗ":"Q",
    "Ŕ":"R",
    "Ř":"R",
    "Ŗ":"R",
    "Ṙ":"R",
    "Ṛ":"R",
    "Ṝ":"R",
    "Ȑ":"R",
    "Ȓ":"R",
    "Ṟ":"R",
    "Ɍ":"R",
    "Ɽ":"R",
    "Ꜿ":"C",
    "Ǝ":"E",
    "Ś":"S",
    "Ṥ":"S",
    "Š":"S",
    "Ṧ":"S",
    "Ş":"S",
    "Ŝ":"S",
    "Ș":"S",
    "Ṡ":"S",
    "Ṣ":"S",
    "Ṩ":"S",
    "Ť":"T",
    "Ţ":"T",
    "Ṱ":"T",
    "Ț":"T",
    "Ⱦ":"T",
    "Ṫ":"T",
    "Ṭ":"T",
    "Ƭ":"T",
    "Ṯ":"T",
    "Ʈ":"T",
    "Ŧ":"T",
    "Ɐ":"A",
    "Ꞁ":"L",
    "Ɯ":"M",
    "Ʌ":"V",
    "Ꜩ":"TZ",
    "Ú":"U",
    "Ŭ":"U",
    "Ǔ":"U",
    "Û":"U",
    "Ṷ":"U",
    "Ü":"U",
    "Ǘ":"U",
    "Ǚ":"U",
    "Ǜ":"U",
    "Ǖ":"U",
    "Ṳ":"U",
    "Ụ":"U",
    "Ű":"U",
    "Ȕ":"U",
    "Ù":"U",
    "Ủ":"U",
    "Ư":"U",
    "Ứ":"U",
    "Ự":"U",
    "Ừ":"U",
    "Ử":"U",
    "Ữ":"U",
    "Ȗ":"U",
    "Ū":"U",
    "Ṻ":"U",
    "Ų":"U",
    "Ů":"U",
    "Ũ":"U",
    "Ṹ":"U",
    "Ṵ":"U",
    "Ꝟ":"V",
    "Ṿ":"V",
    "Ʋ":"V",
    "Ṽ":"V",
    "Ꝡ":"VY",
    "Ẃ":"W",
    "Ŵ":"W",
    "Ẅ":"W",
    "Ẇ":"W",
    "Ẉ":"W",
    "Ẁ":"W",
    "Ⱳ":"W",
    "Ẍ":"X",
    "Ẋ":"X",
    "Ý":"Y",
    "Ŷ":"Y",
    "Ÿ":"Y",
    "Ẏ":"Y",
    "Ỵ":"Y",
    "Ỳ":"Y",
    "Ƴ":"Y",
    "Ỷ":"Y",
    "Ỿ":"Y",
    "Ȳ":"Y",
    "Ɏ":"Y",
    "Ỹ":"Y",
    "Ź":"Z",
    "Ž":"Z",
    "Ẑ":"Z",
    "Ⱬ":"Z",
    "Ż":"Z",
    "Ẓ":"Z",
    "Ȥ":"Z",
    "Ẕ":"Z",
    "Ƶ":"Z",
    "Ĳ":"IJ",
    "Œ":"OE",
    "ᴀ":"A",
    "ᴁ":"AE",
    "ʙ":"B",
    "ᴃ":"B",
    "ᴄ":"C",
    "ᴅ":"D",
    "ᴇ":"E",
    "ꜰ":"F",
    "ɢ":"G",
    "ʛ":"G",
    "ʜ":"H",
    "ɪ":"I",
    "ʁ":"R",
    "ᴊ":"J",
    "ᴋ":"K",
    "ʟ":"L",
    "ᴌ":"L",
    "ᴍ":"M",
    "ɴ":"N",
    "ᴏ":"O",
    "ɶ":"OE",
    "ᴐ":"O",
    "ᴕ":"OU",
    "ᴘ":"P",
    "ʀ":"R",
    "ᴎ":"N",
    "ᴙ":"R",
    "ꜱ":"S",
    "ᴛ":"T",
    "ⱻ":"E",
    "ᴚ":"R",
    "ᴜ":"U",
    "ᴠ":"V",
    "ᴡ":"W",
    "ʏ":"Y",
    "ᴢ":"Z",
    "á":"a",
    "ă":"a",
    "ắ":"a",
    "ặ":"a",
    "ằ":"a",
    "ẳ":"a",
    "ẵ":"a",
    "ǎ":"a",
    "â":"a",
    "ấ":"a",
    "ậ":"a",
    "ầ":"a",
    "ẩ":"a",
    "ẫ":"a",
    "ä":"a",
    "ǟ":"a",
    "ȧ":"a",
    "ǡ":"a",
    "ạ":"a",
    "ȁ":"a",
    "à":"a",
    "ả":"a",
    "ȃ":"a",
    "ā":"a",
    "ą":"a",
    "ᶏ":"a",
    "ẚ":"a",
    "å":"a",
    "ǻ":"a",
    "ḁ":"a",
    "ⱥ":"a",
    "ã":"a",
    "ꜳ":"aa",
    "æ":"ae",
    "ǽ":"ae",
    "ǣ":"ae",
    "ꜵ":"ao",
    "ꜷ":"au",
    "ꜹ":"av",
    "ꜻ":"av",
    "ꜽ":"ay",
    "ḃ":"b",
    "ḅ":"b",
    "ɓ":"b",
    "ḇ":"b",
    "ᵬ":"b",
    "ᶀ":"b",
    "ƀ":"b",
    "ƃ":"b",
    "ɵ":"o",
    "ć":"c",
    "č":"c",
    "ç":"c",
    "ḉ":"c",
    "ĉ":"c",
    "ɕ":"c",
    "ċ":"c",
    "ƈ":"c",
    "ȼ":"c",
    "ď":"d",
    "ḑ":"d",
    "ḓ":"d",
    "ȡ":"d",
    "ḋ":"d",
    "ḍ":"d",
    "ɗ":"d",
    "ᶑ":"d",
    "ḏ":"d",
    "ᵭ":"d",
    "ᶁ":"d",
    "đ":"d",
    "ɖ":"d",
    "ƌ":"d",
    "ı":"i",
    "ȷ":"j",
    "ɟ":"j",
    "ʄ":"j",
    "ǳ":"dz",
    "ǆ":"dz",
    "é":"e",
    "ĕ":"e",
    "ě":"e",
    "ȩ":"e",
    "ḝ":"e",
    "ê":"e",
    "ế":"e",
    "ệ":"e",
    "ề":"e",
    "ể":"e",
    "ễ":"e",
    "ḙ":"e",
    "ë":"e",
    "ė":"e",
    "ẹ":"e",
    "ȅ":"e",
    "è":"e",
    "ẻ":"e",
    "ȇ":"e",
    "ē":"e",
    "ḗ":"e",
    "ḕ":"e",
    "ⱸ":"e",
    "ę":"e",
    "ᶒ":"e",
    "ɇ":"e",
    "ẽ":"e",
    "ḛ":"e",
    "ꝫ":"et",
    "ḟ":"f",
    "ƒ":"f",
    "ᵮ":"f",
    "ᶂ":"f",
    "ǵ":"g",
    "ğ":"g",
    "ǧ":"g",
    "ģ":"g",
    "ĝ":"g",
    "ġ":"g",
    "ɠ":"g",
    "ḡ":"g",
    "ᶃ":"g",
    "ǥ":"g",
    "ḫ":"h",
    "ȟ":"h",
    "ḩ":"h",
    "ĥ":"h",
    "ⱨ":"h",
    "ḧ":"h",
    "ḣ":"h",
    "ḥ":"h",
    "ɦ":"h",
    "ẖ":"h",
    "ħ":"h",
    "ƕ":"hv",
    "í":"i",
    "ĭ":"i",
    "ǐ":"i",
    "î":"i",
    "ï":"i",
    "ḯ":"i",
    "ị":"i",
    "ȉ":"i",
    "ì":"i",
    "ỉ":"i",
    "ȋ":"i",
    "ī":"i",
    "į":"i",
    "ᶖ":"i",
    "ɨ":"i",
    "ĩ":"i",
    "ḭ":"i",
    "ꝺ":"d",
    "ꝼ":"f",
    "ᵹ":"g",
    "ꞃ":"r",
    "ꞅ":"s",
    "ꞇ":"t",
    "ꝭ":"is",
    "ǰ":"j",
    "ĵ":"j",
    "ʝ":"j",
    "ɉ":"j",
    "ḱ":"k",
    "ǩ":"k",
    "ķ":"k",
    "ⱪ":"k",
    "ꝃ":"k",
    "ḳ":"k",
    "ƙ":"k",
    "ḵ":"k",
    "ᶄ":"k",
    "ꝁ":"k",
    "ꝅ":"k",
    "ĺ":"l",
    "ƚ":"l",
    "ɬ":"l",
    "ľ":"l",
    "ļ":"l",
    "ḽ":"l",
    "ȴ":"l",
    "ḷ":"l",
    "ḹ":"l",
    "ⱡ":"l",
    "ꝉ":"l",
    "ḻ":"l",
    "ŀ":"l",
    "ɫ":"l",
    "ᶅ":"l",
    "ɭ":"l",
    "ł":"l",
    "ǉ":"lj",
    "ſ":"s",
    "ẜ":"s",
    "ẛ":"s",
    "ẝ":"s",
    "ḿ":"m",
    "ṁ":"m",
    "ṃ":"m",
    "ɱ":"m",
    "ᵯ":"m",
    "ᶆ":"m",
    "ń":"n",
    "ň":"n",
    "ņ":"n",
    "ṋ":"n",
    "ȵ":"n",
    "ṅ":"n",
    "ṇ":"n",
    "ǹ":"n",
    "ɲ":"n",
    "ṉ":"n",
    "ƞ":"n",
    "ᵰ":"n",
    "ᶇ":"n",
    "ɳ":"n",
    "ñ":"n",
    "ǌ":"nj",
    "ó":"o",
    "ŏ":"o",
    "ǒ":"o",
    "ô":"o",
    "ố":"o",
    "ộ":"o",
    "ồ":"o",
    "ổ":"o",
    "ỗ":"o",
    "ö":"o",
    "ȫ":"o",
    "ȯ":"o",
    "ȱ":"o",
    "ọ":"o",
    "ő":"o",
    "ȍ":"o",
    "ò":"o",
    "ỏ":"o",
    "ơ":"o",
    "ớ":"o",
    "ợ":"o",
    "ờ":"o",
    "ở":"o",
    "ỡ":"o",
    "ȏ":"o",
    "ꝋ":"o",
    "ꝍ":"o",
    "ⱺ":"o",
    "ō":"o",
    "ṓ":"o",
    "ṑ":"o",
    "ǫ":"o",
    "ǭ":"o",
    "ø":"o",
    "ǿ":"o",
    "õ":"o",
    "ṍ":"o",
    "ṏ":"o",
    "ȭ":"o",
    "ƣ":"oi",
    "ꝏ":"oo",
    "ɛ":"e",
    "ᶓ":"e",
    "ɔ":"o",
    "ᶗ":"o",
    "ȣ":"ou",
    "ṕ":"p",
    "ṗ":"p",
    "ꝓ":"p",
    "ƥ":"p",
    "ᵱ":"p",
    "ᶈ":"p",
    "ꝕ":"p",
    "ᵽ":"p",
    "ꝑ":"p",
    "ꝙ":"q",
    "ʠ":"q",
    "ɋ":"q",
    "ꝗ":"q",
    "ŕ":"r",
    "ř":"r",
    "ŗ":"r",
    "ṙ":"r",
    "ṛ":"r",
    "ṝ":"r",
    "ȑ":"r",
    "ɾ":"r",
    "ᵳ":"r",
    "ȓ":"r",
    "ṟ":"r",
    "ɼ":"r",
    "ᵲ":"r",
    "ᶉ":"r",
    "ɍ":"r",
    "ɽ":"r",
    "ↄ":"c",
    "ꜿ":"c",
    "ɘ":"e",
    "ɿ":"r",
    "ś":"s",
    "ṥ":"s",
    "š":"s",
    "ṧ":"s",
    "ş":"s",
    "ŝ":"s",
    "ș":"s",
    "ṡ":"s",
    "ṣ":"s",
    "ṩ":"s",
    "ʂ":"s",
    "ᵴ":"s",
    "ᶊ":"s",
    "ȿ":"s",
    "ɡ":"g",
    "ᴑ":"o",
    "ᴓ":"o",
    "ᴝ":"u",
    "ť":"t",
    "ţ":"t",
    "ṱ":"t",
    "ț":"t",
    "ȶ":"t",
    "ẗ":"t",
    "ⱦ":"t",
    "ṫ":"t",
    "ṭ":"t",
    "ƭ":"t",
    "ṯ":"t",
    "ᵵ":"t",
    "ƫ":"t",
    "ʈ":"t",
    "ŧ":"t",
    "ᵺ":"th",
    "ɐ":"a",
    "ᴂ":"ae",
    "ǝ":"e",
    "ᵷ":"g",
    "ɥ":"h",
    "ʮ":"h",
    "ʯ":"h",
    "ᴉ":"i",
    "ʞ":"k",
    "ꞁ":"l",
    "ɯ":"m",
    "ɰ":"m",
    "ᴔ":"oe",
    "ɹ":"r",
    "ɻ":"r",
    "ɺ":"r",
    "ⱹ":"r",
    "ʇ":"t",
    "ʌ":"v",
    "ʍ":"w",
    "ʎ":"y",
    "ꜩ":"tz",
    "ú":"u",
    "ŭ":"u",
    "ǔ":"u",
    "û":"u",
    "ṷ":"u",
    "ü":"u",
    "ǘ":"u",
    "ǚ":"u",
    "ǜ":"u",
    "ǖ":"u",
    "ṳ":"u",
    "ụ":"u",
    "ű":"u",
    "ȕ":"u",
    "ù":"u",
    "ủ":"u",
    "ư":"u",
    "ứ":"u",
    "ự":"u",
    "ừ":"u",
    "ử":"u",
    "ữ":"u",
    "ȗ":"u",
    "ū":"u",
    "ṻ":"u",
    "ų":"u",
    "ᶙ":"u",
    "ů":"u",
    "ũ":"u",
    "ṹ":"u",
    "ṵ":"u",
    "ᵫ":"ue",
    "ꝸ":"um",
    "ⱴ":"v",
    "ꝟ":"v",
    "ṿ":"v",
    "ʋ":"v",
    "ᶌ":"v",
    "ⱱ":"v",
    "ṽ":"v",
    "ꝡ":"vy",
    "ẃ":"w",
    "ŵ":"w",
    "ẅ":"w",
    "ẇ":"w",
    "ẉ":"w",
    "ẁ":"w",
    "ⱳ":"w",
    "ẘ":"w",
    "ẍ":"x",
    "ẋ":"x",
    "ᶍ":"x",
    "ý":"y",
    "ŷ":"y",
    "ÿ":"y",
    "ẏ":"y",
    "ỵ":"y",
    "ỳ":"y",
    "ƴ":"y",
    "ỷ":"y",
    "ỿ":"y",
    "ȳ":"y",
    "ẙ":"y",
    "ɏ":"y",
    "ỹ":"y",
    "ź":"z",
    "ž":"z",
    "ẑ":"z",
    "ʑ":"z",
    "ⱬ":"z",
    "ż":"z",
    "ẓ":"z",
    "ȥ":"z",
    "ẕ":"z",
    "ᵶ":"z",
    "ᶎ":"z",
    "ʐ":"z",
    "ƶ":"z",
    "ɀ":"z",
    "ﬀ":"ff",
    "ﬃ":"ffi",
    "ﬄ":"ffl",
    "ﬁ":"fi",
    "ﬂ":"fl",
    "ĳ":"ij",
    "œ":"oe",
    "ﬆ":"st",
    "ₐ":"a",
    "ₑ":"e",
    "ᵢ":"i",
    "ⱼ":"j",
    "ₒ":"o",
    "ᵣ":"r",
    "ᵤ":"u",
    "ᵥ":"v",
    "ₓ":"x"};
String.prototype.latinise = function(){return this.replace(/[^A-Za-z0-9\[\] ]/g,function(a){return Latinise.latin_map[a]||a})};


var urlify = function(a){return a.toLowerCase().replace(/[^a-z0-9]+/g, "-").replace(/^-+|-+$/g, "-").replace(/^-+|-+$/g, '')};


var cmsDocument = {
    init: function()
    {
        $('.document-new').click(this.__loadCreateForm);
        $('.document-edit').click(this.__loadEditForm);
        $('.document-delete').click(this.__delete);
    },


    __delete: function(e)
    {
        e.preventDefault();
        if (confirm('Opravdu chcete smazat dokument?'))
        {
            cms.ajax($(this).attr('href'), 'DELETE', cmsDocument.__deleteCallback);
        }
    },

    __deleteCallback: function(data)
    {
        // console.log(data);
        $(location).attr('href', '/');
    },

    /**
     * Nacteni formulare pro pridani stranky
     * @param e
     * @private
     */
    __loadCreateForm: function(e)
    {
        e.preventDefault();
        // nacteme formular pro editaci widgetu
        cms.ajax($(this).attr('href'), 'GET', cmsDocument.__loadCreateFormSuccess);
    },

    /**
     * Nacteni formulare pro editaci stranky
     * @param e
     * @private
     */
    __loadEditForm: function(e)
    {
        e.preventDefault();
        // nacteme formular pro editaci widgetu
        cms.ajax($(this).attr('href'), 'GET', cmsDocument.__loadEditFormSuccess);
    },

    /**
     * Uspesne nacteni formulare pro editaci widgetu = zobrazeni modal okna
     * @param data
     * @private
     */
    __loadCreateFormSuccess: function(data)
    {
        cmsModal.show(data, 'Nová stránka', cmsDocument.__submitCreateForm);

        //
        cmsDocument.__checkUrl();
    },

    __checkUrl: function()
    {
        $('.modal-document-add #form_name').keyup(function(){
            // pokud nedoslo k uprave URL
            var name = $('.modal-document-add #form_name').val();

            if ($('#cms_update_url').val() == 1)
            {
                var url = $('.modal-document-add #form_url').val();

                url = url.replace(/\/[^\/]+$/, "/");

                $('.modal-document-add #form_url').val(url + urlify(name.latinise()));
            }
        });

        $('.modal-document-add #form_url').keyup(function(){
            $('#cms_update_url').val(0);
        });
    },

    /**
     * Uspesne nacteni formulare pro editaci stanky = zobrazeni modal okna
     * @param data
     * @private
     */
    __loadEditFormSuccess: function(data)
    {
        cmsModal.show(data, 'Editace stránky', cmsDocument.__submitEditForm);
    },


    __submitCreateForm: function(e)
    {
        e.preventDefault();

        $.ajax({
            type: "POST",
            url: $(this).attr('action'),
            data: $(this).serialize(), // serializes the form's elements.
            statusCode: {
                200: function(data) {
                    // $('#' + data.region).attr('class', data.class);
                    cmsModal.hide();

                    $(location).attr('href', '/' + data.url);
                    /*
                    var id = cmsWidget.widgetInEdit.data('widget-id');
                    // $('.box-' + id).attr('class', 'box container box-' + id + ' ' +  data.class);
                    // aktualizace tridy widgetu
                    $('#widget-' + id).attr('class', 'widget widget-' + id + ' ' +  data.class);
                    // ulozeni obsahu
                    $('#widget-' + id + ' .widget-content').html(data.html);
                    // nacteni obsahu widgetu
                    // $.fancybox.close('all');
                    $('#cms-modal').modal('hide');
                    */
                },
                400: function(data) {
                    $('#modal-fom-box').replaceWith(data.responseText);
                    $('#modal-edit-form').submit(cmsDocument.__submitCreateForm);
                }
            }
        });
    },

    __submitEditForm: function(e)
    {
        e.preventDefault();

        $.ajax({
            type: "POST",
            url: $(this).attr('action'),
            data: $(this).serialize(), // serializes the form's elements.
            statusCode: {
                200: function(data) {
                    // $('#cms-modal').modal('hide');
                    cmsModal.hide();
                    //if (adminParam['url'] != data.url)
                    //{
                    $(location).attr('href', '/' +  data.url);
                    //}
                },
                400: function(data) {
                    $('#modal-fom-box').replaceWith(data.responseText);
                    $('#modal-edit-form').submit(cmsDocument.__submitCreateForm);
                }
            }
        });
    }
}

var cmsRegion = {

    widgetAddAfter: null,

    init: function()
    {
        // pridani widgetu do regionu jako prvni
        $('.region .widget-plus-region').click(this.__addWidgetRegion);
    },

    /**
     * Pridani widgetu do regionu
     * @param e
     * @private
     */
    __addWidgetRegion: function(e)
    {
        e.preventDefault();
        // ulozime widget, ktery se edituje
        cmsRegion.regionWidgetAdd = $('#' + $(this).data('region-id')) ;
        // nacteme formular pro editaci widgetu
        cmsModal.show($('#widgetlist').html(), 'Nový widget', null);

        $('.widget-new-item').click(cmsRegion.__addWidgetRegionDone)
    },

    __addWidgetRegionDone: function(e)
    {
        // zavreni modalu
        cmsModal.hide();

        // pozadavek na pridani widget na server
        var params = {};
        params['document_id'] = adminParam['document_id'];
        params['region']      = cmsRegion.regionWidgetAdd.data('region');
        params['prev']        = null
        params['next']        = cmsRegion.regionWidgetAdd.find('.widgetsholder').first().data('widget-id');
        params['widget']      = $(this).data('widget');

        $.ajax({
            type: 'PUT',
            data: {
                parameters: JSON.stringify(params)
            },
            // url: admin_urls['col_new'] + '?area_id=' + area_id + '&layout_id=' + layout_id + '&page_id=' + page_id + '&location=' + location + '&ph=' + ph,
            // url: $(ui.item).attr('href') + '?col_id=' + col_id + '&prev_col=' + new_item.prev().attr('col-id') + '&' + droppable.sortable( "serialize" ),
            url: adminUrl['widget_add'],
            cache: false,
            // async: false,
            success: function(data) {
                // alert(data);
                // new_item.replaceWith(data);
                // alert(droppable.sortable( "serialize", { key: "sort" } ));
                // $helper.replaceWith(data.widgetHtml);
                cmsRegion.regionWidgetAdd.find('.widgetsholder').prepend(data.widgetHtml);
                cmsWidget.initWidget('.widget-' + data.id);
            }
        });
    }

}

var cmsWidget = {

    widgetInEdit: null,
    widgetAddAfter: null,
    regionWidgetAdd: null,
    regionInEdit: null,

    initWidget: function(selector)
    {
        this.__addEvents(selector);
        // this.__addContextMenu(selector);

        $('.region-edit').click(this.__loadRegionEditForm);

        dnd.file();
    },

    reloadWidget: function(id)
    {
        var url = Routing.generate('cms_widget_reload', { 'id': id });
        cms.ajax(url, 'GET', cmsWidget.__reloadCallback);
    },

    __reloadCallback: function(data)
    {
        var widgetId = data.id;
        $('.widget-' + widgetId + ' .widget-content').html(data.html);
    },

    openEditDialog: function(id)
    {
        $('.widget-' + id + ' .widget-edit').click();
    },

    __addEvents: function(selector)
    {
        // editace widgetu - nacteni formulare
        $(selector + ' .widget-edit').click(this.__loadEditForm);

        // mazani widgetu
        $(selector + ' .widget-delete').click(this.__delete);

        // pridani podwidgetu
        $(selector + ' .widget-plus').click(this.__addWidget);

        $(selector + ' .widget-copy').click(this.__copyWidget);

        $(selector + ' .widget-paste').click(this.__pasteWidget);

        $(selector + ' .widget-down').click(this.__downWidget);

        $(selector + ' .widget-up').click(this.__upWidget);



    },


    __addImage: function(data)
    {
        cmsWidget.reloadWidget(data.id);
    },

    /**
     * Metoda pro smazani widgetu
     * @param e Objekt udalosti
     * @private
     */
    __delete: function(e)
    {
        e.preventDefault();

        // potvrzeni mazani widgetu vyskakovacim oknem
        if (!confirm('Opravdu chcete smazat widget?')) { return false };

        // ID widgetu z parametru data-widget-id odkazu widget-delete
        var widgetId = $(this).data('widget-id');

        /* odeslani pozadavku na serveru */
        cms.ajax($(this).attr('href'), 'DELETE', $('.widget-' + widgetId).remove());
    },

    /**
     * Nacteni formulare pro editaci widgetu
     * @param e
     * @private
     */
    __loadEditForm: function(e)
    {
        e.preventDefault();
        // ulozime widget, ktery se edituje
        cmsWidget.widgetInEdit = $(this);
        // nacteme formular pro editaci widgetu
        cms.ajax($(this).attr('href'), 'GET', cmsWidget.__loadEditFormSuccess);
    },

    /**
     * Uspesne nacteni formulare pro editaci widgetu = zobrazeni modal okna
     * @param data
     * @private
     */
    __loadEditFormSuccess: function(data)
    {

        cmsModal.show(data, 'Editace obsahu', cmsWidget.__submitWidgetEditForm);
        // cmsWidget.__initDropDocument();
        dnd.document();
        dnd.file();
    },

    __submitWidgetEditForm: function(e)
    {
        e.preventDefault();

        tinyMCE.triggerSave();

        $.ajax({
            type: "POST",
            url: $(this).attr('action'),
            data: $(this).serialize(), // serializes the form's elements.
            statusCode: {
                200: function(data) {
                    var id = cmsWidget.widgetInEdit.data('widget-id');
                    // $('.box-' + id).attr('class', 'box container box-' + id + ' ' +  data.class);
                    // aktualizace tridy widgetu
                    $('.widget-' + id).attr('class', 'widget widget-' + id + ' ' +  data.class);
                    // ulozeni obsahu
                    $('.widget-' + id + ' .widget-content').html(data.html);
                    // nacteni obsahu widgetu
                    // $.fancybox.close('all');
                    cmsModal.hide();
                },
                400: function(data) {
                    cmsModal.tinyDestroy();
                    $('#modal-form-box').replaceWith(data.responseText);
                    $('#modal-edit-form').submit(cmsWidget.__submitWidgetEditForm);
                    cmsModal.tinyInit();
                }
            }
        });

    },

    __copyWidget: function(e)
    {
        $.cookie('cms_copy_widget_id', $(this).data('widget-id'), { path: '/' });
        alert('Widget byl umístěn do schránky');
        $('.widget-paste').addClass('active');
        $('.widget-paste-region').addClass('active');
    },

    __pasteWidget: function(e)
    {
        var copyWidgetId = $.cookie('cms_copy_widget_id');
        // alert(copyWidgetId);

        var insertWidgetId = $(this).data('widget-id');

        // odeslani kopie widgetu na server
        var params = {};
        params['document_id'] = adminParam['document_id'];
        params['region']      = $(this).closest( '.region' ).data('region');
        params['prev']        = $('.widget-' + insertWidgetId).data('widget-id');
        params['next']        = $('.widget-' + insertWidgetId).next().data('widget-id');

        // $.cookie('cms_copy_widget_id', null);
        $.removeCookie('cms_copy_widget_id');

        $.ajax({
            type: 'POST',
            data: {
                parameters: JSON.stringify(params)
            },
            // url: admin_urls['col_new'] + '?area_id=' + area_id + '&layout_id=' + layout_id + '&page_id=' + page_id + '&location=' + location + '&ph=' + ph,
            // url: $(ui.item).attr('href') + '?col_id=' + col_id + '&prev_col=' + new_item.prev().attr('col-id') + '&' + droppable.sortable( "serialize" ),
            url: Routing.generate('cms_widget_copy', { 'id': copyWidgetId }),
            cache: false,
            // async: false,
            success: function(data) {
                $('.widget-' + insertWidgetId).after(data.widgetHtml);
                cmsWidget.initWidget('.widget-' + data.id);
            }
        });

        $('.widget-paste').removeClass('active');
        $('.widget-paste-region').removeClass('active');

    },


    /**
     * Nacteni formulare pro editaci widgetu
     * @param e
     * @private
     */
    __addWidget: function(e)
    {
        e.preventDefault();
        // ulozime widget, ktery se edituje
        cmsWidget.widgetAddAfter = $('.widget-' + $(this).data('widget-id')) ;
        // nacteme formular pro editaci widgetu
        // cms.ajax($(this).attr('href'), 'GET', cmsWidget.__addWidgetListSuccess);
        cmsModal.show($('#widgetlist').html(), 'Nový widget', null);

        $('.widget-new-item').click(cmsWidget.__addWidgetDone)
    },

    __addWidgetDone: function(e)
    {
        // zavreni modalu
        cmsModal.hide();

        // pozadavek na pridani widget na server
        var params = {};
        params['document_id'] = adminParam['document_id'];
        params['region']      = cmsWidget.widgetAddAfter.closest( '.region' ).data('region');
        params['prev']        = cmsWidget.widgetAddAfter.data('widget-id');
        params['next']        = cmsWidget.widgetAddAfter.next().data('widget-id');
        params['widget']      = $(this).data('widget');

        $.ajax({
            type: 'PUT',
            data: {
                parameters: JSON.stringify(params)
            },
            // url: admin_urls['col_new'] + '?area_id=' + area_id + '&layout_id=' + layout_id + '&page_id=' + page_id + '&location=' + location + '&ph=' + ph,
            // url: $(ui.item).attr('href') + '?col_id=' + col_id + '&prev_col=' + new_item.prev().attr('col-id') + '&' + droppable.sortable( "serialize" ),
            url: adminUrl['widget_add'],
            cache: false,
            // async: false,
            success: function(data) {
                // alert(data);
                // new_item.replaceWith(data);
                // alert(droppable.sortable( "serialize", { key: "sort" } ));
                // $helper.replaceWith(data.widgetHtml);
                cmsWidget.widgetAddAfter.after(data.widgetHtml);
                cmsWidget.initWidget('.widget-' + data.id);
            }
        });
    },





    __downWidget: function(e)
    {
        var widgetId = $(this).data('widget-id');
        var $widget = $('.widget-' + widgetId);

        if ($widget.next().length == 0)
        {
            alert('Nelze posunout níž');
            return false;
        }

        $widget.next().after($widget);

        var params = {};
        params['document_id'] = adminParam['document_id'];
        params['region']      = $widget.closest( '.region' ).data('region');
        params['widget_id']   = $widget.data('widget-id');
        params['prev']        = $widget.prev().data('widget-id');
        params['next']        = $widget.next().data('widget-id');

        return cms.ajax(adminUrl['widget_sort'], 'POST', null, { parameters: JSON.stringify(params) });
    },

    __upWidget: function(e)
    {
        var widgetId = $(this).data('widget-id');
        var $widget = $('.widget-' + widgetId);

        if ($widget.prev().length == 0)
        {
            alert('Nelze posunout výš');
            return false;
        }

        $widget.prev().before($widget);

        // console.log($widget.prev());
        //  console.log($widget.next());

        var params = {};
        params['document_id'] = adminParam['document_id'];
        params['region']      = $widget.closest( '.region' ).data('region');
        params['widget_id']   = $widget.data('widget-id');
        params['prev']        = $widget.prev().data('widget-id');
        params['next']        = $widget.next().data('widget-id');

        return cms.ajax(adminUrl['widget_sort'], 'POST', null, { parameters: JSON.stringify(params) });
    },

    /**
     * Nacteni formulare pro editaci widgetu
     * @param e
     * @private
     */
    __loadRegionEditForm: function(e)
    {
        e.preventDefault();
        // ulozime widget, ktery se edituje
        cmsWidget.regionInEdit = $(this);
        // nacteme formular pro editaci widgetu
        cms.ajax($(this).attr('href'), 'GET', cmsWidget.__loadRegionEditFormSuccess);
    },

    /**
     * Uspesne nacteni formulare pro editaci widgetu = zobrazeni modal okna
     * @param data
     * @private
     */
    __loadRegionEditFormSuccess: function(data)
    {
        cmsModal.show(data, 'Editace regionu', cmsWidget.__submitRegionEditForm);
    },

    /*
    __addContextMenu: function(selector)
    {
        $.contextMenu({
            selector: selector + ' .context-menu',
            trigger: 'left',
            callback: function(key, options) {
                var m = "clicked: " + key + ' id=' + $(this).data('widget');
                window.console && console.log(m) || alert(m);
            },
            items: {
                "edit": {name: "Edit", icon: "edit", callback: cmsBox.__edit},
                "cut": {name: "Cut", icon: "cut"},
                copy: {name: "Copy", icon: "copy"},
                "paste": {name: "Paste", icon: "paste"},
                "sep1": "---------",
                "add-box": {name: "Přidat box", icon: "fa-plus"},
                "quit": {name: "Quit", icon: function(){
                    return 'context-menu-icon context-menu-icon-quit';
                }}
            }
        });
    },
    */
    /*
    __afterLoadForm: function(instance, current)
    {
        cmsWidget.widgetInEdit = current.opts.$orig;
        $('#widget-edit-form').submit(cmsWidget.__submitBoxEditForm);
    },*/



    __submitRegionEditForm: function(e)
    {
        e.preventDefault();

        $.ajax({
            type: "POST",
            url: $(this).attr('action'),
            data: $(this).serialize(), // serializes the form's elements.
            statusCode: {
                200: function(data) {
                    // alert(data);
                    $('#' + data.region).attr('class', data.class);

                    cmsModal.hide();

                    $(location).attr('href', '/' + adminParam['url']);
                    /*
                    var id = cmsWidget.widgetInEdit.data('widget-id');
                    // $('.box-' + id).attr('class', 'box container box-' + id + ' ' +  data.class);
                    // aktualizace tridy widgetu
                    $('#widget-' + id).attr('class', 'widget widget-' + id + ' ' +  data.class);
                    // ulozeni obsahu
                    $('#widget-' + id + ' .widget-content').html(data.html);
                    // nacteni obsahu widgetu
                    // $.fancybox.close('all');
                    $('#cms-modal').modal('hide');
                    */
                },
                400: function(data) {
                    $('#modal-fom-box').replaceWith(data.responseText);
                    $('#modal-edit-form').submit(cmsWidget.__submitRegionEditForm);
                }
            }
        });
    }

}

var cmsModal = {
    show: function(data, title, submitHandler) {
        // ziskame element modalu
        var modal = $('#remodal');
        // zobrazime formular
        modal.find('.modal-body').html(data);
        // pridame osetreni udalosti pro odeslani

        $('#modal-edit-form').submit(submitHandler);

        if (submitHandler)
        {
            modal.find('#modal-save-button').show();
        }
        else
        {
            modal.find('#modal-save-button').hide();
        }

        // udalost tlacitka pro ulozeni, ktere neni soucasti formulare
        modal.find('#modal-save-button').click(function(){
            $('#remodal form').submit();
        });


        // nastavime nadpis modalu
        modal.find('.modal-title').text(title);

        this.tinyInit();

        $(document).on('focusin', function(event) {
            if ($(event.target).closest(".mce-window").length) {
                e.stopImmediatePropagation();
            }
        });

        // zobrazeni okna
        // modal.modal();
        // udalost pri uzavreni okna
        /*modal.on('hidden.bs.modal', function () {
            cmsModal.tinyDestroy();
        })*/

        $(document).on('closed', '#remodal', function (e) {
            cmsModal.tinyDestroy()
        });

        modal.remodal().open();
    },

    hide: function()
    {
        // $('#cms-modal').modal('hide');
        $('#remodal').remodal().close();
    },

    tinyInit: function()
    {
        // inicializace tiny
        tinymce.init({
            selector: '#modal-edit-form textarea.tiny',
            themes: "modern",
            menubar: false,
            language: 'cs',
            force_br_newlines : false,
            force_p_newlines : true,
            forced_root_block : '',
            convert_urls: false,
            verify_html: false,
            remove_script_host: false,
            codemirror: { indentOnInit:true, path:'/assets/tinymce/plugins/codemirror/codemirror-4.8'},
            plugins: [
                "advlist autolink link image lists charmap print preview hr anchor pagebreak",
                "searchreplace wordcount visualblocks visualchars insertdatetime media nonbreaking spellchecker",
                "table contextmenu directionality emoticons paste textcolor code codemirror codesample table"
            ],
            height : "250",
            entity_encoding : "raw",
            toolbar1: "undo redo | bold italic underline | forecolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent",
            toolbar2: "styleselect |  image | media | link unlink | table | code codesample"
        });
    },

    tinyDestroy: function()
    {
        if ($("#modal-edit-form textarea.tiny").length/* && tinymce.get('form_html')*/)
        {
            tinymce.remove("textarea.tiny");
        }
    }

}

var cms = {
    init: function () {
        cms.__addEvents();
        // cmsBox.addBox('.box');
        cmsWidget.initWidget('.widget');

        cmsRegion.init();

        cmsDocument.init();

        // cmsContextMenu.init();
        tinyMCE.baseURL = '/assets/tinymce';

        treeDocument.init();

        treeFile.init();

       // postranni box se soubory
        slider.init();

        $("#cms-panel img").hide();
        // $( "#widget-dialog" ).dialog();

    },

    __addEvents: function () {
        $('.edit-mode-toggle').click(cms.__toggleEditModeEvent);
        $('.edit-mode-region-toggle').click(cms.__toggleEditModeRegionEvent);
    },

    __toggleEditModeEvent: function () {
        $.cookie('cms_editmod', !$('body').hasClass('edit-mode'));
        $('body').toggleClass('edit-mode');
    },

    __toggleEditModeRegionEvent: function () {
        $.cookie('cms_editmod_region', !$('body').hasClass('edit-mode-region'));
        $('body').toggleClass('edit-mode-region');
    },

    /**
     * Odeslani AJAX
     * @param url
     * @param method
     * @param successHandler metoda, ktera navratovy kod 200
     * @param data Data pro odeslani na server
     */
    ajax: function (url, method, successHandler, data){
        // nastaveni pozadavku
        var $result = true;
        var settings = {
            type: method,
            url:  url,
            data: data,
            statusCode: {
                // ok - spustime funci pro uspesnem navratu
                200: successHandler,
                // neexistujici stranka
                404: function(data) { $result = false; alert('Stránka neexistuje') },
                // chyba pri ukladani
                500: function(data) { $result = false;  alert('Chyba na serveru') },
                // neopravneny pristup
                403: function(data) { $result = false;  alert('Nejste přihlášeni') }
            } // statusCode
        }

        // odeslani pozadavku metodou AJAX
        $.ajax(settings);

        return $result;
    }
}



/*
$( document ).ready(function() {
  interact('.box-template').draggable();

  interact('.drag-here').dropzone({
    accept: '.box-template',
  });
});
*/

$(window).on("load", function(){
    $("#cms-panel img").hide();
})

$( document ).ready( cms.init );



$( function() {

    $( '.region .widgetsholder' ).sortable({
        connectWith: '.region .widgetsholder',
        items: ".widget",
        revert: false,
        cursor: "move",
        cursorAt: {left: 20, top: 10},
        placeholder: 'emptydiv clear',
        handle: ".widget-toolbar .drag",
        helper: function(event, ui)
        {
            var $clone =  ui.find('span.drag').clone();
            $clone.addClass('sortable-helper');
            var width = ui.find('span.drag').outerWidth();
            $clone.width(width);
            return $clone.get(0);
        },
        // presunuti widgetu
        update: function(event, ui) {
            if (!ui.item.hasClass('widget'))
            {
                return true;
            }

            var $widget = $('.widget-' + ui.item.data('widget-id'));

            var params = {};
            params['document_id'] = adminParam['document_id'];
            params['region']      = $widget.closest( '.region' ).data('region');
            params['widget_id']   = $widget.data('widget-id');
            params['prev']        = $widget.prev().data('widget-id');
            params['next']        = $widget.next().data('widget-id');

            return cms.ajax(adminUrl['widget_sort'], 'POST', null, { parameters: JSON.stringify(params) });
        },
        // vlozeni widgetu
        receive: function(event, ui) {
            // zde prijde pridani widgetu - ajax + vlozeni widgetu do DOMu
            // var new_item  = $(this).data().uiSortable.currentItem;

            /*
            console.log(event);
            console.log(ui);
            console.log($( this ).context.childNodes);

            console.log($( this ).context.childNodes.length);
            for (var i = 0; i < $( this ).context.childNodes.length; i++)
            {
                if ($( this ).context.childNodes[i]['nodeName'] == 'SPAN')
                {

                }
            }*/

            // console.log(new_item.next().attr('id'));
            //console.log(ui.item);
            //console.log($('#box-drag').prev());
            //console.log($('#box-drag').next().data('widget-id'));
            // console.log(ui);
            // ui.helper.replaceWith('<div id="widget-1" data-widget-id="1" class="widget col-md-12"><div class="widget-content"><h1>Nadpis stránky sadas</h1></div></div>');
            var $helper = ui.helper;

            if (!$helper.hasClass('draggable-helper'))
            {
                return false;
            }

            var $widget  = $helper.data('widget');
            // console.log(ui.helper.parent());
            // console.log(event.target.parentElement.data('region'));

            // predame informace - id dokumentu, region, typ regionu, id predchoziho a nasledujiciho widgetu a typ widget
            var params = {};
            params['document_id'] = adminParam['document_id'];
            params['region']      = $(this).closest( '.region' ).data('region');
            params['prev']        = $('#box-drag').prev().data('widget-id');
            params['next']        = $('#box-drag').next().data('widget-id');
            params['widget']      = $widget;

            $.ajax({
              type: 'PUT',
              data: {
                parameters: JSON.stringify(params)
              },
              // url: admin_urls['col_new'] + '?area_id=' + area_id + '&layout_id=' + layout_id + '&page_id=' + page_id + '&location=' + location + '&ph=' + ph,
              // url: $(ui.item).attr('href') + '?col_id=' + col_id + '&prev_col=' + new_item.prev().attr('col-id') + '&' + droppable.sortable( "serialize" ),
              url: adminUrl['widget_add'],
              cache: false,
              // async: false,
              success: function(data) {
                // alert(data);
                // new_item.replaceWith(data);
                // alert(droppable.sortable( "serialize", { key: "sort" } ));
                $helper.replaceWith(data.widgetHtml);
                cmsWidget.initWidget('.widget-' + data.id);
              }
            });

        }
    });


  $( "#cms-panel .widget" ).draggable({
    connectToSortable: ".region .widgetsholder",
    revert: "invalid",
    cursor: 'move',
    appendTo: 'body',
    helper: function()
    {
      return $('<span id="box-drag" data-widget="' + $(this).data('widget')  + '" class="draggable-helper">' + $(this).html() + '</span>');
    },
    cursor: "move",
    cursorAt: {left: 20, top: 10},
    start: function (event, ui) {
        $('.widgets').removeClass('open ');
    },
  });

    $(document).bind("ajaxSend", function(){
        $("#cms-panel img").show();
    }).bind("ajaxComplete", function(){
        $("#cms-panel img").hide();
    });

    $( "#accordion" ).accordion({
        heightStyle: "content"
    });


});




